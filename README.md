# Split and Rename SPF files

A ruby script to chunk SPF files generated by the royalties program VISTA and rename each chunk as _AUTHORNUM\_PAYEENUM\_ISBN\_STATEMENTDATE.spf_.

## Dependencies

Ruby must be installed on the system running the script. The system must also support the basic bash commands `cp` and `rm`.

Splitting the file depends on the following:

* Each file starts with the landscape layout binary code: ESC&l1O followed by a line break followed by an initial FF binary pagebreak
* Page breaks are demarked by the binary FF character
* The first page of every unique statement contains the string "Page 1" somewhere on that page

Renaming depends on 4 spans of data within each statement being formatted as follows:

_Author Number:_

* String: "AUTHOR:""
* Followed by: At least one up to any number of consecutive spaces
* Followed by: At least one up to any number of consecutive digits

_Payee Number:_

* String: "PAYEE:""
* Followed by: At least one up to any number of consecutive spaces
* Followed by: At least one up to any number of consecutive digits

_ISBN_

* String: "978"
* Followed by: 10 digits

_Date_

* String: "ROYALTY STATEMENT FOR PERIOD ENDING "
* Followed by: 2 digits + / + 4 digits

## Distribution End Points

TK

## Deployment

TK

## Stakeholders

* Royalties Department
* Ray Lockwood
* Ed Lewandowski
* Bill Barry
* Fritz Foy

## Usage

On the command line, run:

```
$ ruby splitspfWIN.rb inputfilename.spf
```

Use in conjunction with Folder Actions for Windows (http://www.folderactions.com/), as follows:

* Working directory must contain two folders: "converted" and "original"
* Replace the directory path in line 3 of splitspfWIN.rb with your correct working directory
* In Folder Actions, choose the following:
    * Click the + button and navigate to your working dir
    * Choose "User defined action"
    * Choose "Execute the following (.BAT) script" (second option)
    * In the box, input the following, replacing "path_to_script" with the path to the directory that the script lives, and replacing "working_dir" with the path of your working dir:

```
ruby path_to_script\splitspfWIN.rb %1
move %1 working_dir\original\
```

The script will then run automatically whenever a new file is added to the working directory folder.

Troubleshooting:
* You may need to use the full path to your ruby install, e.g.: C:\Ruby193\bin\ruby.exe